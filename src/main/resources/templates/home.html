<!DOCTYPE html >
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Feedback Cinema - Cliente</title>
    <link rel="stylesheet" href="./css/global.css"/>
    <link rel="stylesheet" href="./css/home.css"/>

    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100,200,300,400,500,600,700,800,900;1,100,200,300,400,500,600,700,800,900&display=swap"
            rel="stylesheet"
    />
</head>
<body>
<!-- Carrossel -->
<header class="big_container flex-center" id="Destaques">
    <div class="container">
        <a href="./usuario/userPage" class="avatar_image flex-center">
            <img src="./image/fotoUser2.png" alt="Avatar" th:if="${session.usuarioLogado != null}"/>
        </a>
        <div class="container_carrossel">
            <div class="carousel">
                <img src="./image/destaque_foto.png" alt="Foto destaque"/>
                <img src="./image/destaque_foto.png" alt="Foto destaque"/>
                <img src="./image/destaque_foto.png" alt="Foto destaque"/>
                <img src="./image/destaque_foto.png" alt="Foto destaque"/>
                <img src="./image/destaque_foto.png" alt="Foto destaque"/>
            </div>
        </div>
    </div>
</header>

<main class="big_container flex-center">
    <div class="container">
        <!-- MENU DE FILTROS DO FILME -->
        <div class="cockpit_filmes flex">
            <div class="cockpit_item flex-center">
                <input type="text" placeholder="Pesquisar" class="input_style"/>
                <a href="usuario/favorite" class="input_style">❤</a>
            </div>
            <ul class="cockpit_item flex-center">
                <li><span>Filtro de Categoria:</span></li>
                <li>
                    <select
                            name="categorias"
                            class="input_style filters_button"
                            id="categoria"
                            autocomplete="off"
                    >
                        <option value="Ação">Ação</option>
                        <option value="Aventura">Aventura</option>
                        <option value="Desenho">Desenho</option>
                        <option value="Ficcao">Ficção</option>
                    </select>
                </li>
            </ul>
        </div>


        <section th:replace="layout :: layout"></section>


    </div>
</main>

<script>
function toggleFavoritoCard(button, event) {
    event.preventDefault();
    event.stopPropagation();
    
    const filmeId = button.getAttribute('data-filme-id');
    const usuarioId = button.getAttribute('data-usuario-id');
    
    // Verificar estado atual (pode adicionar lógica para verificar se já está favoritado)
    const isFavoritado = button.classList.contains('favoritado');
    const url = isFavoritado 
        ? '/usuario/remover-favorito' 
        : '/usuario/favoritar';
    
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `filmeId=${filmeId}&usuarioId=${usuarioId}`
    })
    .then(response => response.text())
    .then(data => {
        if (data.includes('adicionado') || data.includes('removido')) {
            button.classList.toggle('favoritado');
            const svg = button.querySelector('svg path');
            if (button.classList.contains('favoritado')) {
                svg.setAttribute('fill', '#A411D4');
            } else {
                svg.setAttribute('fill', 'none');
            }
        } else {
            alert('Erro ao favoritar filme');
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao processar requisição');
    });
}
</script>
<script src="scriptGlobal.js"></script>
<script src="carrossel.js"></script>
</body>
</html>
