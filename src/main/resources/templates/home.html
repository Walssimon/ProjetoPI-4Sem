<!DOCTYPE html >
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Home Senac Busters</title>
    <link rel="stylesheet" href="./css/global.css"/>
    <link rel="stylesheet" href="./css/home.css"/>

    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100,200,300,400,500,600,700,800,900;1,100,200,300,400,500,600,700,800,900&display=swap"
            rel="stylesheet"
    />
</head>
<body>
<!-- Carrossel -->
<header class="big_container flex-center" id="Destaques">
    <div class="container">
        <a href="./usuario/userPage" class="avatar_image flex-center">
            <img th:src="'data:image/jpeg;base64,' + ${session.usuarioLogado?.getImagemBase64()}" th:if="${session.usuarioLogado != null}"/>
        </a>
        <div class="container_carrossel">
            <div class="carousel">
                <img th:each="filme : ${filmesDestaque}"
                     th:src="@{'data:image/jpeg;base64,' + ${filme.imagemBase64}}"
                     th:alt="${'Capa do filme ' + filme.nomeFilme}"
                     class="carousel-image"/>
            </div>
        </div>

    </div>
</header>

<main class="big_container flex-center">
    <div class="container">
        <!-- MENU DE FILTROS DO FILME -->
        <div class="cockpit_filmes flex">
            <div class="cockpit_item flex-center">

                <!-- üîç FORMUL√ÅRIO DE PESQUISA -->
                <form method="get" action="/home" class="flex" style="width: 100%;">
                    <input
                            type="text"
                            name="nome"
                            placeholder="Pesquisar"
                            class="input_style"
                            th:value="${nomeBuscado}"
                    />

                    <button type="submit" style="display:none"></button>
                </form>

                <a href="usuario/favorite" class="input_style">‚ù§</a>
            </div>
            <ul class="cockpit_item flex-center">
                <li><span>Filtro de Categoria:</span></li>
                <li>
                    <select id="categoria" class="input_style" onchange="filtrarPorGenero()">
                        <option value="" th:selected="${generoSelecionado == null or generoSelecionado == ''}">Todos os
                            G√™neros
                        </option>

                        <option value="Acao" th:selected="${generoSelecionado == 'Acao'}">A√ß√£o</option>
                        <option value="Aventura" th:selected="${generoSelecionado == 'Aventura'}">Aventura</option>
                        <option value="Comedia" th:selected="${generoSelecionado == 'Comedia'}">Com√©dia</option>
                        <option value="Drama" th:selected="${generoSelecionado == 'Drama'}">Drama</option>
                        <option value="Terror" th:selected="${generoSelecionado == 'Terror'}">Terror</option>
                        <option value="Ficcao Cientifica" th:selected="${generoSelecionado == 'Ficcao Cientifica'}">
                            Fic√ß√£o Cient√≠fica
                        </option>
                        <option value="Romance" th:selected="${generoSelecionado == 'Romance'}">Romance</option>
                        <option value="Fantasia" th:selected="${generoSelecionado == 'Fantasia'}">Fantasia</option>
                        <option value="Suspense" th:selected="${generoSelecionado == 'Suspense'}">Suspense</option>
                        <option value="Misterio" th:selected="${generoSelecionado == 'Misterio'}">Misterio</option>
                        <option value="Animacao" th:selected="${generoSelecionado == 'Animacao'}">Animacao</option>
                        <option value="Documentario" th:selected="${generoSelecionado == 'Documentario'}">Documentario
                        </option>
                        <option value="Musical" th:selected="${generoSelecionado == 'Musical'}">Musical</option>
                        <option value="Historico" th:selected="${generoSelecionado == 'Historico'}">Historico</option>
                        <option value="Familia" th:selected="${generoSelecionado == 'Familia'}">Familia</option>
                    </select>
                </li>
            </ul>
        </div>


        <section th:replace="~{layout :: layout}"></section>


    </div>
</main>

<script>
    function toggleFavoritoCard(button, event) {
        event.preventDefault();
        event.stopPropagation();

        const filmeId = button.getAttribute('data-filme-id');
        const usuarioId = button.getAttribute('data-usuario-id');

        // Verificar estado atual (pode adicionar l√≥gica para verificar se j√° est√° favoritado)
        const isFavoritado = button.classList.contains('favoritado');
        const url = isFavoritado
            ? '/usuario/remover-favorito'
            : '/usuario/favoritar';

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `filmeId=${filmeId}&usuarioId=${usuarioId}`
        })
        .then(response => response.text())
        .then(data => {
            if (data.includes('adicionado') || data.includes('removido')) {
                button.classList.toggle('favoritado');
                const svg = button.querySelector('svg path');
                if (button.classList.contains('favoritado')) {
                    svg.setAttribute('fill', '#A411D4');
                } else {
                    svg.setAttribute('fill', 'none');
                }
            } else {
                alert('Erro ao favoritar filme');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao processar requisi√ß√£o');
        });
    }
</script>
<script src="scriptGlobal.js"></script>
<script src="carrossel.js"></script>
<script>
    function filtrarPorGenero() {
           const genero = document.getElementById("categoria").value;

           // Se o valor for vazio (sele√ß√£o "Todos os G√™neros"), redireciona para a home sem o par√¢metro
           if (genero === "") {
                window.location.href = "/home"; // ou simplesmente "/"
           } else {
                // Redireciona usando o par√¢metro de requisi√ß√£o: /home?genero=Acao
                window.location.href = "/home?genero=" + encodeURIComponent(genero);
           }
       }
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
     const carouselWrapper = document.querySelector('.container_carrossel');
     const carousel = document.querySelector('.carousel');
     const images = document.querySelectorAll('.carousel-image');

     // Verifique se os elementos existem
     if (!carousel || images.length === 0) return;

     let currentIndex = 0;
     const totalImages = images.length;

     // Calcula a largura que cada slide deve ter (100% do wrapper)
     const slideWidth = carouselWrapper.clientWidth;

     // Fun√ß√£o para mover o carrossel para a imagem atual
     function moveCarousel() {
         // Mover o cont√™iner interno (.carousel) horizontalmente
         // Calcula o deslocamento (por exemplo, 100% para a segunda imagem, 200% para a terceira)
         const offset = -currentIndex * slideWidth;

         // Aplica o movimento, que ser√° animado pelo CSS 'transition'
         carousel.style.transform = `translateX(${offset}px)`;
     }

     // Fun√ß√£o para avan√ßar
     function nextImage() {
         // Incrementa o √≠ndice, voltando para 0 se atingir o final
         currentIndex = (currentIndex + 1) % totalImages;
         moveCarousel();
     }

     // Garante que o tamanho inicial do slide seja definido (importante para o c√°lculo inicial)
     images.forEach(img => {
         img.style.width = `${slideWidth}px`;
     });

     // Inicia o carrossel (avan√ßa a cada 5 segundos, por exemplo)
     if (totalImages > 1) {
         setInterval(nextImage, 5000); // Mude 5000 (ms) para a velocidade desejada
     }

     // Adiciona listener para reajustar o tamanho do slide ao redimensionar a janela
     window.addEventListener('resize', () => {
         // Recalcula a largura ao redimensionar
         const newSlideWidth = carouselWrapper.clientWidth;

         images.forEach(img => {
             img.style.width = `${newSlideWidth}px`;
         });

         // Move para a posi√ß√£o correta com a nova largura
         moveCarousel();
     });
 });
</script>
</body>
</html>
